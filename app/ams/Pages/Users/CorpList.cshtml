@page "/sys/corp/list"
@model InnateGlory.Pages.Users.CorpListModel

@section head {
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/lib/webix/skins/flat.min.css" />
    <link rel="stylesheet" href="~/lib/Font-Awesome/css/all.min.css" />
    <link rel="stylesheet" href="~/css/site.css" />
}

<script src="~/lib/webix/webix.js"></script>
<script src="~/lib/jquery/jquery.min.js"></script>
<script src="~/js/site.js"></script>

<script type="text/javascript">
    webix.ready(function () {
        var detail_h;

        webix.ui({
            id: 'layout',
            //container: 'layout_div',
            //width: document.body.clientWidth,
            //height: document.body.clientHeight,
            rows: [
                {
                    id: 'grid1',
                    view: "datatable",
                    leftSplit: 3,
                    //rightSplit: 1,
                    header: true,
                    footer: false,
                    columns: [
                        { id: "index", header: "", sort: "int" },
                        { id: 'Id', hidden: true },
                        { id: 'Name', header: '@lang["Name"]' },
                        { id: 'Active', header: '@lang["Active"]' },
                        { id: 'DisplayName', header: '@lang["DisplayName"]' },
                        { id: 'Currency', header: '@lang["Currency"]' },
                        { id: 'CreateTime', header: '@lang["CreateTime"]' },
                        { id: 'CreateUser', header: '@lang["CreateUser"]' },
                        { id: 'ModifyTime', header: '@lang["ModifyTime"]' },
                        { id: 'ModifyUser', header: '@lang["ModifyUser"]' },
                        { header: 'xxx', width: 0 }
                    ],
                    scheme: {
                        $init: function (obj) { obj.index = this.count(); }
                    },
                    select: 'row',
                    //autowidth: true,
                    //autoheight: true,
                    //data: small_film_set
                    on: {
                        //onItemDblClick: function (id, e, node) {
                        //    var row = this.getItem(id);
                        //    top_row = row;
                        //    nav2.text(row.Name).show();
                        //    switch_tab('.nav2');
                        //    //var n = $$('top_nav');
                        //    //var index = n.optionIndex('nav1');
                        //    //n.data.options[index].value = row.Name;
                        //    //n.showOption('nav1');
                        //    //n.refresh();
                        //    console.log('onItemDblClick2', arguments);
                        //},
                        onSelectChange: function () {
                            var ids = this.getSelectedId(true);
                            if (ids.length >= 1) {
                                //console.log(ids, item);
                                var item = this.getItem(ids[0].id)

                                var id = item.Id;
                                if (detail_h != null) {
                                    clearTimeout(detail_h);
                                }
                                detail_h = setTimeout(function () {
                                    detail_h = null;
                                    $$('detail').define('src', '@Url.Page("/Users/CorpDetail")?id=' + item.Id);
                                }, 1000);
                            }
                        }
                    }
                },
                { view: "resizer", height: 3 },
                { id: 'detail', view: 'iframe', borderless: true, }
            ]
        });
        attachEvents($$('grid1'), webix.events.datatable);

        //console.log('loading...')
        util.api('@Url.Action("List", "Corps")', {
            Paging: {
                PageIndex: 0,
                PageSize: 50
            }
        }, function (result) {
            if (result.IsSuccess) {
                $$('grid1').parse(result.Data);
            }
        });

        webix.event(window, 'resize', function () {
            console.log('window.resize');
            //var grid = $$('layout');
            //grid.config.width = document.body.clientWidth;
            //grid.config.height = document.body.clientHeight;
            $$('layout').resize();
        });
    });
</script>